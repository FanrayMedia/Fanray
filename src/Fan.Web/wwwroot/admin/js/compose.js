let Delta=Quill.import('delta');const Clipboard=Quill.import('modules/clipboard');class PlainClipboard extends Clipboard{onPaste(a){a.preventDefault();const b=this.quill.getSelection(),c=a.clipboardData.getData('text/plain'),d=new Delta().retain(b.index).delete(b.length).insert(c),e=c.length+b.index;this.quill.updateContents(d,'silent'),this.quill.setSelection(e,0,'silent'),this.quill.scrollIntoView(),clearTimeout(this.typingTimer),app.published||(app.showSave=!0,app.disableSave=!1,app.saveText='Save',this.typingTimer=setTimeout(app.saveDraft,app.doneTypingInterval))}}Quill.register('modules/clipboard',PlainClipboard,!0);var app=new Vue({el:'#app',data:()=>({id:0,published:!1,pubClicked:!1,pubText:'',showSave:!1,disableSave:!1,saveText:'Save',closing:!0,fieldChanged:!1,drawer:null,menuDate:!1,date:'',selectedCatId:1,cats:[],selectedTags:[],tags:[],slug:'',excerpt:'',title:'',quill:null,toolbarOptions:[[{header:[!1,1,2,3,4,5,6]}],['bold','italic','underline','strike'],[{list:'ordered'},{list:'bullet'},{list:'check'}],['blockquote','code-block'],['link','image','video'],[{align:''},{align:'center'},{align:'right'},{align:'justify'}],[{indent:'-1'},{indent:'+1'}],[{color:[]},{background:[]}],['clean']],mediaDialogVisible:!1,images:[],change:null,doneTypingInterval:5e3}),computed:{showMediaDialog:{get:function(){return this.mediaDialogVisible&&this.getImages(),this.mediaDialogVisible},set:function(a){a||(this.mediaDialogVisible=!1)}},disablePubButton(){return 0>=this.title.trim().length||this.pubClicked},tok:function(){return document.querySelector('input[name="__RequestVerificationToken"][type="hidden"]').value},payload:function(){let a=this.quill.root.innerHTML;return'<p><br></p>'===a&&(a=''),{id:this.id,postDate:this.date,categoryId:this.selectedCatId,tags:this.selectedTags,slug:this.slug,excerpt:this.excerpt,title:this.title,body:a}}},mounted(){this.initHighlight(),this.initEditor()},methods:{initEditor(){this.quill=new Quill('#editor',{modules:{syntax:!0,toolbar:this.toolbarOptions,imageResize:{}},theme:'snow'}),this.id=0|window.location.href.substring(window.location.href.lastIndexOf('/')+1),axios.get(`/admin/compose?handler=post&postId=${this.id}`).then(a=>{this.date=a.data.post.postDate,this.selectedCatId=a.data.post.categoryId,this.selectedTags=a.data.post.tags,this.slug=a.data.post.slug,this.excerpt=a.data.post.excerpt,this.title=a.data.post.title,this.quill.clipboard.dangerouslyPasteHTML(a.data.post.body),this.published=a.data.published,this.cats=a.data.allCats,this.tags=a.data.allTags,this.pubText=this.published?'Update':'Publish',this.change=new Delta;let b;this.quill.on('text-change',a=>{this.change=this.change.compose(a),clearTimeout(b),0<this.change.length()&&!this.published&&(this.showSave=!0,this.disableSave=!1,this.saveText='Save',b=setTimeout(this.saveDraft,this.doneTypingInterval))}),window.onbeforeunload=()=>{if((0<this.change.length()||this.fieldChanged)&&this.closing)return'There are unsaved changes. Are you sure you want to leave?'}});let a=this.quill.getModule('toolbar');a.addHandler('image',()=>this.mediaDialogVisible=!0)},initHighlight(){hljs.configure({languages:['cs','css','java','javascript','markdown','ruby','python','scss','sql','typescript','xml']})},onFieldsChange(){this.fieldChanged=!0;this.published||(this.showSave=!0,this.disableSave=!1,this.saveText='Save')},saveDraft(){this.showSave=!0,this.disableSave=!0,this.saveText='Saving...',axios.post('/admin/compose?handler=save',this.payload,{headers:{"XSRF-TOKEN":this.tok}}).then(a=>{this.id=a.data.id,this.slug=a.data.slug,window.location.href.endsWith('/compose')&&history.replaceState({},null,window.location.href+`/${this.id}`)}).catch(()=>{}),this.change=new Delta,this.fieldChanged=!1,this.saveText='Saved'},revert(){this.published=!1,this.pubText=this.published?'Update':'Publish',this.saveDraft()},pub(){this.closing=!1,this.pubClicked=!0,this.pubText=this.published?'Updating...':'Publishing...';const a=this.published?'/admin/compose?handler=update':'/admin/compose?handler=publish';axios.post(a,this.payload,{headers:{"XSRF-TOKEN":this.tok}}).then(a=>{window.location.replace(a.data)}).catch(()=>{})},uploadImages(){const a=document.createElement('input');a.setAttribute('type','file'),a.setAttribute('accept','image/*'),a.setAttribute('multiple',null),a.click(),a.onchange=()=>{const b=new FormData;for(let c=0;c<a.files.length;c++)b.append('images',a.files[c]);axios.post('/admin/media?handler=image',b,{headers:{"XSRF-TOKEN":this.$root.tok}}).then(a=>{this.images=a.data.images}).catch(()=>{})}},getImages(){`/admin/media?handler=images`;axios.get('/admin/media?handler=images').then(a=>{this.images=a.data.images}).catch(()=>void 0)},insertImage(a){const b=this.quill.getSelection();this.quill.insertEmbed(b.index,'image',a),this.mediaDialogVisible=!1}}});
//# sourceMappingURL=compose.js.map